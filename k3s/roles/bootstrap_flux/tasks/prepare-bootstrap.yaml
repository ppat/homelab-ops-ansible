---
- name: "prepare | Create temp directory for flux bootstrap"
  ansible.builtin.tempfile:
    state: directory
    suffix: -flux-bootstrap
  register: bootstrap_flux_tempdir

- name: "prepare | Copy git ssh key"
  ansible.builtin.copy:
    src: "{{ flux_bootstrap.source.git.ssh_key }}"
    dest: "{{ bootstrap_flux_tempdir.path }}/git-ssh-key"
    owner: root
    group: root
    mode: '0600'

- name: "prepare | Copy bootstrap setting file"
  ansible.builtin.template:
    src: "{{ item }}"
    dest: "{{ bootstrap_flux_tempdir.path }}/{{ item }}"
    owner: root
    group: root
    mode: '0600'
  loop:
  - "source-git.yaml"

- ansible.builtin.shell: >
    ls -al {{ bootstrap_flux_tempdir.path }}
  register: prerequisites_list

- debug:
    var: prerequisites_list
