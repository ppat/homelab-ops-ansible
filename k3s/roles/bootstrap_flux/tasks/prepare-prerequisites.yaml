---
- name: "prepare | Create temp directory for flux prerequisites"
  ansible.builtin.tempfile:
    state: directory
    suffix: -flux-prerequisites
  register: prerequisites_tempdir

- name: "prepare | Copy prerequisites"
  ansible.builtin.copy:
    # to copy only the content from flux_bootstrap.prerequisites directory, ensure there's a trailing slash in src
    # we strip any trailing slashes (if any) in flux_bootstrap.prerequisites parameter and add our own to guarantee
    # there's only one.
    src: "{{ flux_bootstrap.prerequisites | regex_replace('\\/$', '') }}/"
    dest: "{{ prerequisites_tempdir.path }}"
    owner: root
    group: root
    mode: '0600'

- ansible.builtin.shell: >
    ls -al {{ prerequisites_tempdir.path }}
  register: prerequisites_list

- debug:
    var: prerequisites_list
